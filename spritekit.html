



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>SpriteKit - Videojuegos para Dispositivos Móviles</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#spritekit" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="Videojuegos para Dispositivos Móviles" class="md-header-nav__button md-logo">
          
            <img src="imagenes/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Videojuegos para Dispositivos Móviles
            </span>
            <span class="md-header-nav__topic">
              
                SpriteKit
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="Videojuegos para Dispositivos Móviles" class="md-nav__button md-logo">
      
        <img src="imagenes/logo.png" width="48" height="48">
      
    </a>
    Videojuegos para Dispositivos Móviles
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" title="Presentación" class="md-nav__link">
      Presentación
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="videojuegos_para_moviles.html" title="Introducción a los videojuegos móviles" class="md-nav__link">
      Introducción a los videojuegos móviles
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Fundamentos de los motores
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Fundamentos de los motores
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="fundamentos-motores.html" title="Escena y nodos" class="md-nav__link">
      Escena y nodos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="motor_de_fisicas.html" title="Físicas" class="md-nav__link">
      Físicas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="sprites_e_interaccion.html" title="Sprites" class="md-nav__link">
      Sprites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="escenario_y_fondos.html" title="Fondo y scroll" class="md-nav__link">
      Fondo y scroll
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Motores para  móviles
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Motores para  móviles
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        SpriteKit
      </label>
    
    <a href="spritekit.html" title="SpriteKit" class="md-nav__link md-nav__link--active">
      SpriteKit
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creacion-de-un-proyecto-de-spritekit" title="Creación de un proyecto de SpriteKit" class="md-nav__link">
    Creación de un proyecto de SpriteKit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-escena-de-spritekit" title="La escena de SpriteKit" class="md-nav__link">
    La escena de SpriteKit
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creacion-de-la-escena" title="Creación de la escena" class="md-nav__link">
    Creación de la escena
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presentar-la-escena" title="Presentar la escena" class="md-nav__link">
    Presentar la escena
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ciclo-de-vida-de-la-escena" title="Ciclo de vida de la escena" class="md-nav__link">
    Ciclo de vida de la escena
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arbol-de-la-escena" title="Árbol de la escena" class="md-nav__link">
    Árbol de la escena
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#propiedades-de-los-nodos" title="Propiedades de los nodos" class="md-nav__link">
    Propiedades de los nodos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construccion-del-arbol-de-la-escena" title="Construcción del árbol de la escena" class="md-nav__link">
    Construcción del árbol de la escena
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tipos-de-nodos" title="Tipos de nodos" class="md-nav__link">
    Tipos de nodos
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etiqueta-de-texto" title="Etiqueta de texto" class="md-nav__link">
    Etiqueta de texto
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fisicas" title="Físicas" class="md-nav__link">
    Físicas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-mundo-fisico" title="El mundo físico" class="md-nav__link">
    El mundo físico
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-un-cuerpo-fisico" title="Creación de un cuerpo físico" class="md-nav__link">
    Creación de un cuerpo físico
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propiedades-de-los-cuerpos-fisicos" title="Propiedades de los cuerpos físicos" class="md-nav__link">
    Propiedades de los cuerpos físicos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuerzas-e-impulsos" title="Fuerzas e impulsos" class="md-nav__link">
    Fuerzas e impulsos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#busqueda-de-cuerpos" title="Búsqueda de cuerpos" class="md-nav__link">
    Búsqueda de cuerpos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#colisiones" title="Colisiones" class="md-nav__link">
    Colisiones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layering" title="Layering" class="md-nav__link">
    Layering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uniones" title="Uniones" class="md-nav__link">
    Uniones
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acciones" title="Acciones" class="md-nav__link">
    Acciones
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cambios-en-propiedades-de-los-objetos" title="Cambios en propiedades de los objetos" class="md-nav__link">
    Cambios en propiedades de los objetos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composicion-de-acciones" title="Composición de acciones" class="md-nav__link">
    Composición de acciones
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="scenekit.html" title="SceneKit" class="md-nav__link">
      SceneKit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="cocos2d-x.html" title="Cocos2d-x" class="md-nav__link">
      Cocos2d-x
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="unity.html" title="Unity" class="md-nav__link">
      Unity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="box2d.html" title="Box2D" class="md-nav__link">
      Box2D
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="mandos.html" title="Controles del videojuego" class="md-nav__link">
      Controles del videojuego
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="adaptacion_a_moviles.html" title="Adaptación a diferentes dispositivos" class="md-nav__link">
      Adaptación a diferentes dispositivos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="redes_sociales.html" title="Logros y marcadores" class="md-nav__link">
      Logros y marcadores
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creacion-de-un-proyecto-de-spritekit" title="Creación de un proyecto de SpriteKit" class="md-nav__link">
    Creación de un proyecto de SpriteKit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-escena-de-spritekit" title="La escena de SpriteKit" class="md-nav__link">
    La escena de SpriteKit
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creacion-de-la-escena" title="Creación de la escena" class="md-nav__link">
    Creación de la escena
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presentar-la-escena" title="Presentar la escena" class="md-nav__link">
    Presentar la escena
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ciclo-de-vida-de-la-escena" title="Ciclo de vida de la escena" class="md-nav__link">
    Ciclo de vida de la escena
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arbol-de-la-escena" title="Árbol de la escena" class="md-nav__link">
    Árbol de la escena
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#propiedades-de-los-nodos" title="Propiedades de los nodos" class="md-nav__link">
    Propiedades de los nodos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construccion-del-arbol-de-la-escena" title="Construcción del árbol de la escena" class="md-nav__link">
    Construcción del árbol de la escena
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tipos-de-nodos" title="Tipos de nodos" class="md-nav__link">
    Tipos de nodos
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etiqueta-de-texto" title="Etiqueta de texto" class="md-nav__link">
    Etiqueta de texto
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fisicas" title="Físicas" class="md-nav__link">
    Físicas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-mundo-fisico" title="El mundo físico" class="md-nav__link">
    El mundo físico
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-un-cuerpo-fisico" title="Creación de un cuerpo físico" class="md-nav__link">
    Creación de un cuerpo físico
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propiedades-de-los-cuerpos-fisicos" title="Propiedades de los cuerpos físicos" class="md-nav__link">
    Propiedades de los cuerpos físicos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuerzas-e-impulsos" title="Fuerzas e impulsos" class="md-nav__link">
    Fuerzas e impulsos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#busqueda-de-cuerpos" title="Búsqueda de cuerpos" class="md-nav__link">
    Búsqueda de cuerpos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#colisiones" title="Colisiones" class="md-nav__link">
    Colisiones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layering" title="Layering" class="md-nav__link">
    Layering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uniones" title="Uniones" class="md-nav__link">
    Uniones
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acciones" title="Acciones" class="md-nav__link">
    Acciones
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cambios-en-propiedades-de-los-objetos" title="Cambios en propiedades de los objetos" class="md-nav__link">
    Cambios en propiedades de los objetos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composicion-de-acciones" title="Composición de acciones" class="md-nav__link">
    Composición de acciones
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="spritekit">SpriteKit<a class="headerlink" href="#spritekit" title="Permanent link">&para;</a></h1>
<h2 id="creacion-de-un-proyecto-de-spritekit">Creación de un proyecto de SpriteKit<a class="headerlink" href="#creacion-de-un-proyecto-de-spritekit" title="Permanent link">&para;</a></h2>
<p>Desde Xcode podemos crear un proyecto de tipo <em>Game</em>, y nos preguntará cuál de las librerías nativas queremos utilizar como base. </p>
<p><img alt="&quot;Creacion de un proyecto de tipo _Game_" src="imagenes/nativo/ios-game.png" />
<img alt="&quot;Selección de librería para videojuegos&quot;" src="imagenes/nativo/ios-apis.png" /></p>
<p>En este caso vamos a empezar trabajando con <strong>SpriteKit</strong>, el <em>framework</em> nativo de la plataforma iOS destinado al desarrollo de aplicaciones que muestren cualquier tipo de gráficos 2D animados, como es el caso de los videojuegos 2D. </p>
<p>Xcode nos ofrecerá además <strong>herramientas visuales</strong> en el entorno para crear las escenas del videojuego. </p>
<p>Conviene destacar también que esta tecnología presenta abundantes <strong>similitudes con el motor Cocos2d-x</strong>, por lo que la transición entre estas tecnologías será muy sencilla. </p>
<p>Todas las clases de SpriteKit tienen el prefijo <code>SK</code>, y se encuentra disponible a partir de iOS 7.</p>
<h2 id="la-escena-de-spritekit">La escena de SpriteKit<a class="headerlink" href="#la-escena-de-spritekit" title="Permanent link">&para;</a></h2>
<p>Como en prácticamente todos los motores para videojuegos, SpriteKit utiliza una organización <strong>jerárquica</strong> de los elementos <strong>escena</strong>, es decir, todos los elementos de la escena son <strong>nodos</strong> que se organizan en forma de de árbol. </p>
<p>Tendremos una escena para cada estado (pantalla) del juego (menú principal, opciones, partida, etc). </p>
<h3 id="creacion-de-la-escena">Creación de la escena<a class="headerlink" href="#creacion-de-la-escena" title="Permanent link">&para;</a></h3>
<p>Para crear una escena normalmente crearemos una clase que herede de <code>SKScene</code>, por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">import</span> <span class="nc">SpriteKit</span>

<span class="kd">class</span> <span class="nc">MenuScene</span><span class="p">:</span> <span class="bp">SKScene</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Aunque podemos crear una escena de forma totalmente programada, Xcode nos ofrece la posibilidad de definir la escena (o parte de ella) de forma visual. Para ello deberemos crear un recurso de tipo <em>SpriteKit Scene</em> desde Xcode, con <em>File &gt; New &gt; File ... &gt; iOS &gt; Resource &gt; SpriteKit Scene</em>:</p>
<p><img alt="&quot;Creación de una escena&quot;" src="imagenes/nativo/sk-scene.png" /></p>
<blockquote>
<p>En la plantilla que crea el entorno al seleccionar un proyecto de tipo <em>SpriteKit</em> veremos que tenemos ya creada una escena con nombre <code>GameScene.sks</code>.</p>
</blockquote>
<p>La escena se quedará guardada en un fichero con extensión <code>.sks</code> (<em>Sprite Kit Scene</em>). Podemos cargar este recurso desde el código simplemente proporcionando el nombre de la escena al siguiente constructor de <code>SKScene</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">scene</span> <span class="p">=</span> <span class="bp">SKScene</span><span class="p">(</span><span class="n">fileNamed</span><span class="p">:</span> <span class="s">&quot;MenuScene&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>En el caso del código anterior, cargará el contenido del fichero <code>MenuScene.sks</code>.</p>
<p>El escenario más común será aquel en el que definamos una escena mediante el editor visual, pero asociando dicha escena a una subclase de <code>SKScene</code> propia donde personalicemos el comportamiento de dicha escena. </p>
<p>Podemos asociar una clase propia a dicha escena creada de forma visual utilizando el <em>Inspector de Custom Class</em> del editor de la escena (dentro del panel derecho del entorno):</p>
<p><img alt="Inspector de Custom Class" src="imagenes/nativo/custom_class_inspector.png" /></p>
<p>Ahora, si cargamos dicha escena desde el código, la clase que se utilizará para instanciarla será la clase <code>MenuScene</code> que hemos definido anteriormente, en lugar de la clase genérica <code>SKScene</code>.</p>
<h3 id="presentar-la-escena">Presentar la escena<a class="headerlink" href="#presentar-la-escena" title="Permanent link">&para;</a></h3>
<p>Para poder mostrar esa escena necesitaremos previamente contar con una vista de tipo <code>SKView</code>, que hará de contenedor de escenas. Con esta clase podremos presentar una escena, o bien cambiar la escena que se está mostrando, realizando así una transición entre escenas. </p>
<p>Por ejemplo, podemos introducir una vista de este tipo dentro de nuestro controlador en el <em>storyboard</em>. En el <strong>código de inicialización de nuestro controlador</strong> podemos obtener dicha vista y cargar en ella la escena principal:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

    <span class="k">if</span> <span class="kd">let</span> <span class="nv">view</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span> <span class="k">as</span><span class="p">!</span> <span class="bp">SKView</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">// Carga la escena del fichero &#39;MenuScene.sks&#39;</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">scene</span> <span class="p">=</span> <span class="bp">SKScene</span><span class="p">(</span><span class="n">fileNamed</span><span class="p">:</span> <span class="s">&quot;MenuScene&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Presenta la escena en la vista</span>
            <span class="n">view</span><span class="p">.</span><span class="n">presentScene</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Hemos de recordar que el constructor de la escena toma como parámetro el nombre del fichero <code>.sks</code> de la escena a cargar, omitiendo la extensión. </p>
<h3 id="ciclo-de-vida-de-la-escena">Ciclo de vida de la escena<a class="headerlink" href="#ciclo-de-vida-de-la-escena" title="Permanent link">&para;</a></h3>
<p>Dentro de la clase de la escena, podemos sobrescribir cualquiera de los siguientes métodos para responder a eventos de su ciclo de vida:</p>
<ul>
<li><code>sceneDidLoad()</code>: Se invoca cuando la escena va a ser presentada, para su inicialización. Este evento tendrá lugar antes de que la escena haya sido añadida a la vista.</li>
<li><code>didMove(to:)</code>: Se invoca en el momento en el que la escena se añade a la vista. Este es un buen momento para inicializar los elementos de la interfaz de la escena. </li>
<li><code>didChangeSize()</code>: Se invoca si se produce un cambio en el tamaño de la escena. Por ejemplo, si queremos soportar el cambio de orientación del dispositivo, deberemos implementar este método para indicar cómo adaptar de forma correcta la disposición de los elementos en pantalla. </li>
<li><code>willMove(from:)</code>: Nos indica cuando la escena va a ser eliminada de la vista, posiblemente por cerrar la vista o por hacer una transición a otra escena.</li>
</ul>
<p>Habitualmente aprovecharemos <code>didMove(to:)</code> para crear de forma programada el contenido de la escena (o parte de él). Este contenido se definirá como un árbol de nodos (objetos de tipo <code>SKNode</code> o de alguna de sus subclases).</p>
<h2 id="arbol-de-la-escena">Árbol de la escena<a class="headerlink" href="#arbol-de-la-escena" title="Permanent link">&para;</a></h2>
<p>La escena de SpriteKit se define como un árbol de nodos, todos ellos de tipo <code>SKNode</code> o alguna de sus subclases. </p>
<p>Los nodos genéricos se instancian mediante el constructor vacío de <code>SKNode</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">nodo</span> <span class="p">=</span> <span class="bp">SKNode</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Este tipo de nodos no mostrarán nada en la escena, pero son útiles para agrupar otros nodos en el árbol de la escena y poder moverlos de forma conjunta. Más adelante veremos otros tipos de nodos que heredan de <code>SKNode</code>, como los <em>sprites</em> y las etiquetas de texto.</p>
<h3 id="propiedades-de-los-nodos">Propiedades de los nodos<a class="headerlink" href="#propiedades-de-los-nodos" title="Permanent link">&para;</a></h3>
<p>Todos los nodos (clases que heredan de <code>SKNode</code>) comparten una serie de propiedades comunes heredadas de dicha clase. </p>
<p>Podremos cambiar la posición (x,y) de todos los nodos en la escena, así como su orden z, que determinará qué nodos se muestran por delante de otros:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">nodo</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="bp">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">nodo</span><span class="p">.</span><span class="n">zPosition</span> <span class="p">=</span> <span class="mi">5</span>
</pre></div>
</td></tr></table>

<p>También podremos cambiar su rotación y su escala (x,y):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">nodo</span><span class="p">.</span><span class="n">zRotation</span> <span class="p">=</span> <span class="mi">90</span>
<span class="n">nodo</span><span class="p">.</span><span class="n">xScale</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">nodo</span><span class="p">.</span><span class="n">yScale</span> <span class="p">=</span> <span class="mi">1</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Es de especial interés la posibilidad de hacer un escalado de -1, para así crear un efecto "espejo".</p>
</blockquote>
<h3 id="construccion-del-arbol-de-la-escena">Construcción del árbol de la escena<a class="headerlink" href="#construccion-del-arbol-de-la-escena" title="Permanent link">&para;</a></h3>
<p>Además de estas propiedades, otra característica importante de los nodos es su método <code>addChild:</code>, que nos permite añadir otro nodo como hijo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">grupo</span> <span class="p">=</span> <span class="bp">SKNode</span><span class="p">()</span>
<span class="n">grupo</span><span class="p">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">nodo</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>El agrupamiento jerárquico de nodos es importante porque nos permitirá por ejemplo mover de forma conjunta todo un grupo de nodos cambiando únicamente la posición del nodo padre.</p>
</blockquote>
<p>Para eliminar un nodo del árbol, simplemente deberemos indicar que sea eliminado de su nodo padre:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">nodo</span><span class="p">.</span><span class="n">removeFromParent</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Encontraremos también métodos y propiedades para conocer quién es el padre de un nodo, o moverlo a otro nodo padre, entre otras funciones.</p>
<h2 id="tipos-de-nodos">Tipos de nodos<a class="headerlink" href="#tipos-de-nodos" title="Permanent link">&para;</a></h2>
<p>Destacamos los siguiente tipos de nodos:</p>
<ul>
<li><code>SKLabelNode</code>: Subclase de <code>SKNode</code> que mostrará una etiqueta de texto en la escena.</li>
<li><code>SKSpriteNode</code>: Subclase de <code>SKNode</code> que mostrará un <em>sprite</em> en la escena. </li>
<li><code>SKShapeNode</code>:    Muestra formas básicas y contenido de <em>Core Graphics</em>.</li>
<li><code>SKVideoNode</code>:    Muestra un reproductor de vídeo.</li>
<li><code>SKCropNode</code>: Recorta el contenido de sus hijos.</li>
<li><code>SKReferenceNode</code>: Hace referencia a contenido compartido en un fichero <code>.sks</code>.</li>
</ul>
<h3 id="etiqueta-de-texto">Etiqueta de texto<a class="headerlink" href="#etiqueta-de-texto" title="Permanent link">&para;</a></h3>
<p>Un tipo de nodo fundamental es la etiqueta de texto (<code>SKLabelNode</code>) que nos permitirá mostrar texto en la escena. Este tipo de nodo se puede crear a partir de la fuente a utilizar:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">etiq</span> <span class="p">=</span> <span class="bp">SKLabelNode</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>A parte de las propiedades generales de los nodos, la propiedad más importante de este tipo de nodo es <code>text</code>, que nos permite especificar el texto a mostrar por la etiqueta:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">etiq</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Super Mobile Game&quot;</span>
</pre></div>
</td></tr></table>

<p>Este tipo de nodos nos permitirá cambiar además el tipo de fuente, su color, o la alineación del texto.</p>
<h4>Sprites</h4>
<p>El tipo de nodo más importante en un videojuego es el <em>sprite</em>, que representa aquellas entidades que aparecen en la escena (personajes, objetos, etc), y que se muestran como una imagen o una animación. Podemos crear un <em>sprite</em> a partir del nombre de la imagen que queremos que muestre:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">sprite</span> <span class="p">=</span> <span class="bp">SKSpriteNode</span><span class="p">(</span><span class="n">imageNamed</span><span class="p">:</span> <span class="s">&quot;mario&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Dado que el <em>sprite</em> muestra una imagen en la escena, una propiedad importante será <code>size</code>, que nos indicará el tamaño del <em>sprite</em> en puntos. Esto será importante porque se tendrá en cuenta también para el cálculo de colisiones con otros <em>sprites</em> de la escena. </p>
<p>Además, tambien tiene una propiedad <code>anchorPoint</code>, cuyo valor por defecto es <code>(0.5, 0.5)</code>, y que siempre tomará valores entre <code>(0.0, 0.0)</code> y <code>(1.0, 1.0)</code>. Esta propiedad nos indicará cómo posicionar el <em>sprite</em> en la escena cuando modifiquemos su propiedad <code>position</code>. Se trata de las coordenadas locales dentro de la imagen del <em>sprite</em> que se situarán en la posición indicada por <code>position</code>, siendo:</p>
<ul>
<li><code>(0.0, 0.0)</code> es la esquina inferior izquierda del <em>sprite</em>.</li>
<li><code>(0.5, 0.5)</code> es el centro del <em>sprite</em>.</li>
<li><code>(1.0, 1.0)</code> es la esquina superior derecha del <em>sprite</em>.</li>
</ul>
<h2 id="fisicas">Físicas<a class="headerlink" href="#fisicas" title="Permanent link">&para;</a></h2>
<p>La librería SpriteKit integra su propio motor de físicas. Los distintos elementos de este motor de físicas vienen representados por las siguientes clases:</p>
<table>
<thead>
<tr>
<th>Clase</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SKPhysicsWorld</code></td>
<td>El mundo físico en el que se producirá la simulación, que estará contenido dentro de la escena (<code>SKScene</code>), en su propiedad <code>physicsWorld</code></td>
</tr>
<tr>
<td><code>SKPhysicsBody</code></td>
<td>Los cuerpos físicos estarán vinculados a cada nodo (<code>SKNode</code>), en su propiedad <code>physicsBody</code>.</td>
</tr>
<tr>
<td><code>SKPhysicsJoint</code></td>
<td>Nos permitirá establecer uniones entre diferentes cuerpos físicos (<code>SKPhysicsBody</code>)</td>
</tr>
</tbody>
</table>
<p>Como podemos ver, el motor físico está totalmente integrado dentro de los elementos básicos de SpriteKit: <code>SKScene</code> y <code>SKNode</code>. </p>
<ul>
<li>Para que un nodo pase a estar controlado por el motor de físicas, simplemente deberemos añadir un objeto <code>SKPhysicsBody</code> a su propiedad <code>physicsBody</code>.</li>
<li>Si queremos modificar propiedades generales del mundo físico, podemos acceder a él en la propiedad <code>physicsWorld</code> de nuestra escena.</li>
</ul>
<p>Vamos a ver con más detalle como utilizar el motor de físicas de SpriteKit.</p>
<h3 id="el-mundo-fisico">El mundo físico<a class="headerlink" href="#el-mundo-fisico" title="Permanent link">&para;</a></h3>
<p>Desde la clase de nuestra escena, podemos acceder al mundo físico con:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">scene</span><span class="p">.</span><span class="n">physicsWorld</span>
</pre></div>
</td></tr></table>

<p>Una de las propiedades del mundo físico que podemos modificar es la <strong>gravedad</strong>, que se aplicará sobre todos los cuerpos del mundo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">physicsWorld</span><span class="p">.</span><span class="n">gravity</span> <span class="p">=</span> <span class="bp">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>A partir de este objeto, general de la escena, además de controlar la gravedad del mundo, podremos añadir uniones entre cuerpos o comprobar colisiones como veremos más adelante.</p>
<h3 id="creacion-de-un-cuerpo-fisico">Creación de un cuerpo físico<a class="headerlink" href="#creacion-de-un-cuerpo-fisico" title="Permanent link">&para;</a></h3>
<p>Para utilizar el motor de físicas, lo primero que deberemos hacer es crear un cuerpo físico. Por ejemplo, podemos añadir un cuerpo físico a nuestro <em>sprite</em> de la siguiente forma:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">lata</span> <span class="p">=</span> <span class="bp">SKSpriteNode</span><span class="p">(</span><span class="n">texture</span><span class="p">:</span> <span class="n">texturaLata</span><span class="p">)</span>
<span class="n">lata</span><span class="p">.</span><span class="n">physicsBody</span> <span class="p">=</span> <span class="bp">SKPhysicsBody</span><span class="p">(</span>
    <span class="n">rectangleOf</span><span class="p">:</span> <span class="bp">CGSize</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="n">lata</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
                        <span class="n">height</span><span class="p">:</span> <span class="n">lata</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>Podemos observar que al definir el cuerpo físico, debemos especificar su geometría de colisión en el constructor. Deberemos buscar una geometría <strong>lo más sencilla posible</strong>, que <strong>se adapte de la mejor forma posible al <em>sprite</em></strong>. Podemos buscar entre los constructores de <code>SKPhysicsBody</code> el que resulte más adecuado.</p>
<p>Para cuerpos estáticos o dinámicos, podemos utilizar las siguientes geometrías (de más sencillas a más complejas):</p>
<ul>
<li><code>circle</code>. Se crea a partir de su <strong>radio</strong>.</li>
<li><code>rectangle</code>. Se crea a partir de sus dimensiones (<code>CGSize</code>)</li>
<li><code>poligon</code>. Se crea a partir de una polilínea cerrada (<code>CGPath</code>)</li>
<li><code>texture</code>. Se crea a partir de la <strong>textura</strong> de un <em>sprite</em>. Se generará de forma automática un polígono convexo que se ajuste de forma aproximada al <em>sprite</em>, buscando un compromiso entre eficiencia y exactitud. </li>
<li><code>bodies</code>. Cuerpo compuesto por <strong>varios cuerpos</strong>. De estos cuerpos sólo cogerá <em>sus formas</em>, para generar una nueva forma resultado de su unión. Las propiedades del cuerpo resultante serán las establecidas en el padre, ignorando las de los cuerpos hijo. </li>
</ul>
<p>Todas las formas anteriores suponen regiones <strong>solidas</strong>. Además, tenemos las siguientes geometrías basadas en aristas (sin relleno), que al ser de mayor complejidad (podremos tener formas cóncavas) sólo pueden ser utilizadas en cuerpos estáticos:</p>
<ul>
<li><code>edge</code>. Se crea a partir de sus dos puntos extremo (<code>CGPoint</code>).</li>
<li><code>edgeLoop</code>. Se puede crear a partir de un rectángulo (<code>CGRect</code>) o de una polilínea cerrada (<code>CGPath</code>). La primera forma será más eficiente.</li>
<li><code>edgeChain</code>. Se puede crear a partir de una polilínea abierta (<code>CGPath</code>)</li>
</ul>
<p>Por ejemplo, es habitual definir los límites de la escena como un cuerpo con geometría <code>edgeLoop</code> de la siguiente forma:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">physicsBody</span> <span class="p">=</span> <span class="bp">SKPhysicsBody</span><span class="p">(</span><span class="n">edgeLoopFrom</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">frame</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Ten en cuenta que estos límites no pueden ser de tipo <code>rectangle</code> porque dicha forma es <strong>sólida</strong>, y para poder tener contenido dentro de la escena necesitamos que sea <em>hueco</em>.</p>
</blockquote>
<h3 id="propiedades-de-los-cuerpos-fisicos">Propiedades de los cuerpos físicos<a class="headerlink" href="#propiedades-de-los-cuerpos-fisicos" title="Permanent link">&para;</a></h3>
<p>Además de su forma, los cuerpos físicos tienen una serie de propiedades que podemos configurar:</p>
<table>
<thead>
<tr>
<th>Propiedad</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>isDynamic</code></td>
<td>Establece si es <strong>dinámico</strong> o <strong>estático</strong> (SpriteKit no incluye el tipo <em>kinematic</em>)</td>
</tr>
<tr>
<td><code>mass</code></td>
<td>Masa del cuerpo (en <span><span class="MathJax_Preview">kg</span><script type="math/tex">kg</script></span>). De forma alternativa, podemos especificar la masa mediante la densidad (<code>density</code>, en <span><span class="MathJax_Preview">kg/m^2</span><script type="math/tex">kg/m^2</script></span>) y el área (<code>area</code>, dada en <span><span class="MathJax_Preview">m^2</span><script type="math/tex">m^2</script></span>).</td>
</tr>
<tr>
<td><code>friction</code></td>
<td>Coeficiente de fricción de la superficie</td>
</tr>
<tr>
<td><code>restitution</code></td>
<td>Coeficiente de restitución (rebote)</td>
</tr>
<tr>
<td><code>linearDamping</code></td>
<td>Resistencia al aire lineal</td>
</tr>
<tr>
<td><code>angularDamping</code></td>
<td>Resistencia al aire angular</td>
</tr>
</tbody>
</table>
<h3 id="fuerzas-e-impulsos">Fuerzas e impulsos<a class="headerlink" href="#fuerzas-e-impulsos" title="Permanent link">&para;</a></h3>
<p>Podemos aplicar fuerzas o impulsos sobre los <strong>cuerpos dinámicos</strong>. En el siguiente caso, se aplicarán en su centro de masas, lo cual producirá únicamente una aceleración lineal:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">body</span><span class="p">.</span><span class="n">applyForce</span><span class="p">(</span><span class="bp">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">body</span><span class="p">.</span><span class="n">applyImpulse</span><span class="p">(</span><span class="bp">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>SpriteKit nos permitirá aplicarlos también en cualquier otro punto del cuerpo, lo cual producirá tanto una aceleración lineal como angular:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">body</span><span class="p">.</span><span class="n">applyForce</span><span class="p">(</span><span class="bp">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">at</span><span class="p">:</span> <span class="bp">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">))</span>
<span class="n">body</span><span class="p">.</span><span class="n">applyImpulse</span><span class="p">(</span><span class="bp">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">at</span><span class="p">:</span> <span class="bp">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>También tenemos la opción de aplicar un par de fuerzas (<em>torque</em>), para así producir únicamente aceleración angular:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">body</span><span class="p">.</span><span class="n">applyTorque</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Además, se podrá modificar directamente tanto la velocidad lineal como angular. Esto es útil por ejemplo si queremos parar un cuerpo, o darle una velocidad inicial:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">body</span><span class="p">.</span><span class="n">velocity</span> <span class="p">=</span> <span class="bp">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">body</span><span class="p">.</span><span class="n">angularVelocity</span> <span class="p">=</span> <span class="mf">0.5</span>
</pre></div>
</td></tr></table>

<h3 id="busqueda-de-cuerpos">Búsqueda de cuerpos<a class="headerlink" href="#busqueda-de-cuerpos" title="Permanent link">&para;</a></h3>
<p>Existe diferentes formas de buscar cuerpos en determinadas regiones del mundo.</p>
<p><strong>Búsqueda por punto</strong>. Nos dice si hay algún cuerpo en un punto determinado:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">physicsWorld</span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="n">punto</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p><strong>Búsqueda por área</strong>. Similar al anterior, pero comprueba si hay algún cuerpo dentro de un área rectangular:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">physicsWorld</span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="n">rectangulo</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p><strong>Trazado de rayos</strong>. Este es un <em>test</em> habitual en los motores de física, y nos permite comprobar si hay algún cuerpo a lo largo de una línea. Es útil por ejemplo para implementar disparos, y comprobar si en la trayectoria de un disparo hay algún objeto que debamos destruir. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">physicsWorld</span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">alongRayStart</span><span class="p">:</span> <span class="n">puntoInicio</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">puntoFin</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Todos los métodos anteriores nos proporcionan el primer cuerpo que encuentren en la zona de búsqueda. Tambinén contamos con una variante de dichos métodos (<code>enumerateBodies</code>) que nos devolverá la lista de todos los cuerpos que encuentre en la zona correspondiente.</p>
<h3 id="colisiones">Colisiones<a class="headerlink" href="#colisiones" title="Permanent link">&para;</a></h3>
<p>Será habitual necesitar conocer cuándo se produce una colisión o contacto entre cuerpos (por ejemplo, si un proyectil impacta contra una estructura, aplicar daño a dicha estructura). Para tener constancia de dichos contactos deberemos implementar un <em>delegado de contactos</em> que adopte el protocolo <code>SKPhysicsContactDelegate</code>. Podemos adoptar dicho delegado en la propia clase de nuestra escena. </p>
<p>Tras esto, podremos definir los métodos <code>didBegin(:)</code> y <code>didEnd(:)</code>, a los que avisará cuando comience y cuando finalice un contacto entre cuerpos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">func</span> <span class="nf">didBegin</span><span class="p">(</span><span class="kc">_</span> <span class="n">contact</span><span class="p">:</span> <span class="bp">SKPhysicsContact</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="n">bodyA</span><span class="p">.</span><span class="n">node</span><span class="p">?.</span><span class="n">name</span><span class="p">==</span><span class="s">&quot;campana&quot;</span> <span class="o">||</span>
       <span class="n">contact</span><span class="p">.</span><span class="n">bodyB</span><span class="p">.</span><span class="n">node</span><span class="p">?.</span><span class="n">name</span><span class="p">==</span><span class="s">&quot;campana&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">reproduceSonidoCamapana</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Hay que destacar que en la colisión siempre intervendrán dos cuerpos: <code>bodyA</code> y <code>bodyB</code>, y que el orden en el que pueden venir es arbitrario, por lo que habrá que tener en cuenta cualquier posibilidad. </p>
<p>Además, del contacto también nos indicará el <strong>punto</strong> en el que se ha producido, la <strong>normal</strong> a la superficie de contacto, y el <strong>impulso</strong> del contacto, es decir, la reacción necesaria para mantener los cuerpos separados. Dicho impulso se puede tomar como una medida relacionada con la energía de la colisión, que podría ser utilizada para saber cuánto daño debemos aplicar.</p>
<p>Una vez definido el <em>delegado de contactos</em>, deberemos añadirlo como <em>delegado</em> en el mundo físico:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">physicsWorld</span><span class="p">.</span><span class="n">contactDelegate</span> <span class="p">=</span> <span class="kc">self</span>
</pre></div>
</td></tr></table>

<h3 id="layering">Layering<a class="headerlink" href="#layering" title="Permanent link">&para;</a></h3>
<p>SpriteKit nos permite filtrar qué cuerpos colisionan con otros mediante una serie de máscaras binarias:</p>
<ul>
<li><code>categoryBitMask</code> nos permite definir diferentes categorías de objetos. Cada bit de la máscara representa una categoría, por ejemplo:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">personajeCategoryMask</span> <span class="p">:</span> <span class="nb">UInt32</span> <span class="p">=</span> <span class="mb">0b0001</span> <span class="c1">// 1 </span>
<span class="kd">let</span> <span class="nv">enemigosCategoryMask</span> <span class="p">:</span> <span class="nb">UInt32</span> <span class="p">=</span>  <span class="mb">0b0010</span> <span class="c1">// 2 </span>
<span class="kd">let</span> <span class="nv">balasCategoryMask</span> <span class="p">:</span> <span class="nb">UInt32</span> <span class="p">=</span>     <span class="mb">0b0100</span> <span class="c1">// 4</span>
</pre></div>
</td></tr></table></li>
<li><code>collisionBitMask</code> nos indica con qué categorías de cuerpos podremos colisionar. Por ejemplo, si a los enemigos les damos un valor de <code>0b0011</code>, el enemigo colisionará con nuestro personaje y otros enemigos, pero será atravesado por las balas. Si a las balas les damos un valor <code>0b0000</code> atravesarán tanto al jugador y a los enemigos como otras balas. </li>
<li><code>contactTestBitMask</code> nos indica con qué categorías de cuerpos nos notificará los contactos en el <em>listener de contactos</em>. Por ejemplo, si a las balas les damos un valor <code>0b0011</code> nos notificará cuando <em>toquen</em> a un enemigo o a un personaje, y así podremos "matarlo". Si al personaje le damos un valor <code>0b0010</code>, nos avisará únicamente cuando nos toque un enemigo.</li>
</ul>
<h3 id="uniones">Uniones<a class="headerlink" href="#uniones" title="Permanent link">&para;</a></h3>
<p>Podemos establecer uniones entre cuerpos con diferentes subclases de <code>SKPhysicsJoint</code>:</p>
<ul>
<li><code>SKPhysicsJointFixed</code>: Unión "solida" entre dos objetos, como si estuvieran pegados en un determinado punto.</li>
<li><code>SKPhysicsJointLimit</code>: Union de tipo "cuerda". Habrá una distancia máxima entre dos cuerpos.</li>
<li><code>SKPhysicsJointPin</code>: Los puntos quedan "clavados" entre si en un punto determinado, pudiendo rotar alrededor de dicho punto.</li>
<li><code>SKPhysicsJointSliding</code>: Unión de tipo "rail". Los dos cuerpos pueden deslizarse a lo largo de un eje determinado.</li>
<li><code>SKPhysicsJointSpring</code>: Unión de tipo "resorte". Es como si un muelle uniese los dos cuerpos, con un determinado coeficiente de elasticidad.</li>
</ul>
<p>Por ejemplo, podemos crear una unión de tipo <em>pin</em> de la siguiente forma:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">pinJoint</span> <span class="p">=</span> <span class="bp">SKPhysicsJointPin</span><span class="p">.</span><span class="n">joint</span><span class="p">(</span><span class="n">withBodyA</span><span class="p">:</span> <span class="n">corcho</span><span class="p">.</span><span class="n">physicsBody</span><span class="p">,</span>
                                       <span class="n">bodyB</span><span class="p">:</span> <span class="n">poster</span><span class="p">.</span><span class="n">physicsBody</span><span class="p">,</span> 
                                       <span class="n">anchor</span><span class="p">:</span> <span class="n">posicionPin</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Una vez definida la unión e indicados los dos cuerpos que unirá, debemos añadirla al mundo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">physicsWorld</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">pinJoint</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>De la misma forma, podemos <em>desconectar</em> los cuerpos eliminando la unión del mundo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">physicsWorld</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pinJoint</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2 id="acciones">Acciones<a class="headerlink" href="#acciones" title="Permanent link">&para;</a></h2>
<p>Nos permiten programar el comportamiento de los nodos de la escena, de forma que realicen una serie de acciones de forma automática durante el tiempo que dure su ejecución. </p>
<p>Todas las acciones se crean mediante métodos de <code>SKAction</code>, y en casi todas ellas deberemos especificar el tiempo que durará la acción. Por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">accion</span> <span class="p">=</span> <span class="bp">SKAction</span><span class="p">.</span><span class="n">fadeIn</span><span class="p">(</span><span class="n">withDuration</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="p">````</span>

<span class="n">Esta</span> <span class="n">acción</span> <span class="n">hará</span> <span class="n">un</span> <span class="n">fundido</span> <span class="n">de</span> <span class="n">entrada</span> <span class="p">(</span><span class="n">desde</span> <span class="n">transparente</span> <span class="n">hasta</span> <span class="n">opaco</span><span class="p">)</span> <span class="n">durante</span> <span class="mi">1</span> <span class="n">segundo</span> <span class="n">en</span> <span class="n">el</span> <span class="n">nodo</span> <span class="n">en</span> <span class="n">el</span> <span class="n">que</span> <span class="n">la</span> <span class="n">ejecutemos</span><span class="p">.</span> <span class="n">Ejecutaremos</span> <span class="n">la</span> <span class="n">acción</span> <span class="n">sobre</span> <span class="n">un</span> <span class="n">nodo</span> <span class="n">con</span><span class="p">:</span>

<span class="p">```</span><span class="n">swift</span>
 <span class="n">node</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">accion</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Podemos también detener todas las acciones que esté ejecutando un nodo con:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span> <span class="n">node</span><span class="p">.</span><span class="n">removeAllActions</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Si queremos detener una acción concreta, deberemos ejecutarla con una clave que nos permita identificarla, y posteriormente detenerla a partir de dicha clave:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">node</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">accion</span><span class="p">,</span> <span class="n">withKey</span><span class="p">:</span> <span class="s">&quot;fundido&quot;</span><span class="p">)</span>

<span class="p">...</span>

<span class="n">node</span><span class="p">.</span><span class="n">removeAction</span><span class="p">(</span><span class="n">forKey</span><span class="p">:</span> <span class="s">&quot;fundido&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3 id="cambios-en-propiedades-de-los-objetos">Cambios en propiedades de los objetos<a class="headerlink" href="#cambios-en-propiedades-de-los-objetos" title="Permanent link">&para;</a></h3>
<p>Dentro de <code>SKAction</code> encontramos númerosos métodos factoría para crear diferentes tipos de acciones. Por ejemplo, tenemos acciones para mover un nodo a una posición o rotarlo a un cierto ángulo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">accionMoverFinal</span> <span class="p">=</span> <span class="bp">SKAction</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="bp">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">200</span><span class="p">),</span> <span class="n">duration</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">accionRotarFinal</span> <span class="p">=</span> <span class="bp">SKAction</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">toAngle</span><span class="p">:</span> <span class="mf">3.14</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">accionMoverInicio</span> <span class="p">=</span> <span class="bp">SKAction</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="bp">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">100</span><span class="p">),</span> <span class="n">duration</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">accionRotarInicio</span> <span class="p">=</span> <span class="bp">SKAction</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">toAngle</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>En estas acciones se indica la posición o ángulo destino a la que se moverá el nodo, y el tiempo que tardará en hacerlo (en segundos).</p>
<p>Existen también acciones que nos permiten modificar la escala o la opacidad de un nodo, o incluso actuar sobre las físicas.</p>
<h3 id="composicion-de-acciones">Composición de acciones<a class="headerlink" href="#composicion-de-acciones" title="Permanent link">&para;</a></h3>
<p>Podemos crear acciones que se creen a partir de la combinación de varias acciones:</p>
<ul>
<li><code>sequence</code>. Combina varias acciones en secuencia. La duración de la escena resultante será la suma de la duración de todas las acciones contenidas.</li>
<li><code>group</code>. Combina varias acciones en paralelo. La acción resultante terminará cuando termine la más larga de las acciones que contenga.</li>
</ul>
<p>Por ejemplo, podemos crear una secuencia con las acciones anteriores:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">accionSecuencia</span> <span class="p">=</span> <span class="bp">SKAction</span><span class="p">.</span><span class="n">sequence</span><span class="p">(</span>
    <span class="p">[</span><span class="n">accionMoverFinal</span><span class="p">,</span> 
     <span class="n">accionRotarFinal</span><span class="p">,</span> 
     <span class="n">accionMoverInicio</span><span class="p">,</span> 
     <span class="n">accionRotarInicio</span><span class="p">])</span>
</pre></div>
</td></tr></table>

<p>Además, podemos hacer que una acción se repita:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">accionRepite</span> <span class="p">=</span> <span class="bp">SKAction</span><span class="p">.</span><span class="n">repeatForever</span><span class="p">(</span><span class="n">accionSecuencia</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Con esta última acción podemos especificar por ejemplo el movimiento de "patrulla" de un enemigo, que se moverá contínuamente entre los puntos <code>(100, 100)</code> y <code>(200, 200)</code>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="escenario_y_fondos.html" title="Fondo y scroll" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Fondo y scroll
              </span>
            </div>
          </a>
        
        
          <a href="scenekit.html" title="SceneKit" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                SceneKit
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>